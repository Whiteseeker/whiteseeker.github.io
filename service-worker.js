/*! blog 2016-07-12 */
function handleErrors(a){if(!a.ok)throw Error(a.statusText);return a}importScripts("https://cdn.firebase.com/js/client/2.4.2/firebase.js");var CACHE_NAME="my-site-cache-v1";String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b});var notifurl="/";self.addEventListener("push",function(a){var b=new Firebase("https://luminous-inferno-9971.firebaseio.com/pninfos");a.waitUntil(b.once("value").then(function(a){console.log(a.val());var b=a.val(),c="New post!";b.title&&(c=b.title);var d="Curious ? Check that out (^_^)";b.body&&(d=b.body);var e="/assets/images/icon_192_192.png";b.iconurl&&(e=b.iconurl),b.url?(console.log("notif.url="+b.url),notifurl=b.url):notifurl="/";var f="simple-push-demo-notification-tag";return caches.open(CACHE_NAME).then(function(a){return fetch(notifurl).then(function(b){return a.put(notifurl,b.clone()),b.json()})}),self.registration.showNotification(c,{body:d,icon:e,tag:f,requireInteraction:!0})},function(a){return console.log("The read failed: "+a.code),self.registration.showNotification("New post!",{body:"Curious ? Check that out (^_^)",icon:"/assets/images/icon_192_192.png",tag:"simple-push-demo-notification-tag",requireInteraction:!0})}))}),self.addEventListener("notificationclick",function(a){console.log("On notification click: ",a.notification.tag),a.notification.close(),console.log("notifurl="+notifurl),a.waitUntil(clients.matchAll({type:"window"}).then(function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.url==notifurl&&"focus"in c)return c.focus()}return clients.openWindow?clients.openWindow(notifurl):void 0}))}),this.addEventListener("activate",function(a){var b=[CACHE_NAME];a.waitUntil(caches.keys().then(function(a){return Promise.all(a.map(function(a){return console.log("Cache: "+a),-1===b.indexOf(a)?(console.log("Deleting cache: "+a),caches.delete(a)):void 0}))}))});var urlsToCache=["/css/critical.min.css","/css/merged.min.css","/css/photoswipe/photoswipe-ui-default.min.js","/css/photoswipe/photoswipe.min.js","/scripts/material.min.js","/scripts/modernizr-custom.min.js","/assets/images/favicon.png","/assets/images/icon_192_192.png"],optionalUrlsToCache=["/assets/images/play_badge.png","/assets/images/apple_badge.svg","/assets/images/no_wifi.svg"];self.addEventListener("install",function(a){a.waitUntil(caches.open(CACHE_NAME).then(function(a){return a.addAll(optionalUrlsToCache),a.addAll(urlsToCache)}))}),self.addEventListener("fetch",function(a){var b=new URL(a.request.url);if(b.origin==location.origin){if(/^\/$/.test(b.pathname))return void a.respondWith(caches.open(CACHE_NAME).then(function(b){return fetch(a.request).then(function(c){return b.put(a.request,c.clone()),c}).catch(function(){return b.match(a.request)})}));if(/^\/assets\/images\/[^\/]+\/.+\.\w+$/.test(b.pathname)){if(/\.gif$/.test(b.pathname))return void a.respondWith(fetch(a.request).then(handleErrors).then(function(a){return console.log("Success fetching .gif : "+b),a}).catch(function(a){return console.log("Fail fetching .gif, try using default svg: "+a),caches.match(new Request("/assets/images/no_wifi.svg"))}));if(b.pathname.endsWith(".png.webp")&&!b.pathname.endsWith("_small.png.webp")||b.pathname.endsWith(".png")&&!b.pathname.endsWith("_small.png"))return void a.respondWith(fetch(a.request).then(handleErrors).then(function(a){return console.log("Success fetching : "+b),a}).catch(function(b){console.log("Fail fetching .png(.webp), try using _small.png(.webp): "+b);var c=new Request(a.request.url.replace(".png","_small.png"));return caches.match(c).then(function(a){return a||caches.match(new Request("/assets/images/no_wifi.svg"))})}));if(b.pathname.endsWith("_small.png.webp")||b.pathname.endsWith("_small.png.webp"))return void a.respondWith(caches.open(CACHE_NAME).then(function(c){return c.match(a.request).then(function(d){return d||fetch(a.request).then(handleErrors).then(function(d){return console.log("Success fetching : "+b),c.put(a.request,d.clone()),d}).catch(function(a){return console.log("Fail fetching ["+b+"], try using default svg: "+a),caches.match(new Request("/assets/images/no_wifi.svg"))})})}))}a.respondWith(caches.open(CACHE_NAME).then(function(b){return b.match(a.request).then(function(c){return c||fetch(a.request).then(function(c){return b.put(a.request,c.clone()),c})})}))}return"https://fonts.googleapis.com"==b.origin?(console.log("Loading google font"),void a.respondWith(caches.open(CACHE_NAME).then(function(b){return fetch(a.request).then(function(c){return b.put(a.request,c.clone()),c}).catch(function(){return b.match(a.request)})}))):void 0});