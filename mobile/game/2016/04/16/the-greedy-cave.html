<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="A front-end template that helps you build fast, modern mobile web apps.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Blog</title>

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" sizes="192x192" href="/assets/images/icon_192_192.png">
  <link rel="manifest" href="/manifest.json">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Material Design Lite">
  <link rel="apple-touch-icon-precomposed" href="/assets/images/icon_192_192.png">

  <!-- Tile icon for Win8 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
  <meta name="msapplication-TileColor" content="#3372DF">

  <meta name="theme-color" content="#3F51B5">
  <link rel="shortcut icon" href="/assets/images/favicon.png">

  <meta name="google-site-verification" content="G5DNU81K0TiZ4pd6NaBXaUwv0XgI_bI7NHlaMymkrN8" />
  <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
  <link rel="canonical" href="https://whiteseeker.github.io/mobile/game/2016/04/16/the-greedy-cave.html">

  <link rel="stylesheet" href="/css/critical.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  
  

  <!-- Google Analytics -->
  <script>
  var host = "whiteseeker.github.io";
  if ((host == window.location.host) && (window.location.protocol != "https:"))
      window.location.protocol = "https";
  
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-70962121-1', {'siteSpeedSampleRate': 40});
  ga('send', 'pageview');
  </script>
  <script async src='//www.google-analytics.com/analytics.js'></script>
  <script src="/scripts/modernizr-custom.min.js"></script>
  <!-- End Google Analytics -->

</head>


  <body class="mdl-demo mdl-color--grey-100 mdl-color-text--grey-700 mdl-base">

    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <!-- Always shows a header, even in smaller screens. -->

  <header class="mdl-layout__header">
    <div class="mdl-layout__header-row">
      
      <a href="/" class="mdl-navigation__link site_title"><span class="mdl-layout-title" >Blog</span></a>
      
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation mdl-layout--large-screen-only">
        <a class="mdl-navigation__link" href="/about/">About</a>
      </nav>
    </div>
  </header>
  <div class="mdl-layout__drawer blog-drawer">
    <div class="mdl-card__title"><h2 class="mdl-card__title-text">Blog</h2></div>
    <!--button data-rv-vanilla-modal="#target-modal" class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored blog-button-login">
      <i class="material-icons">add</i>
    </button-->
    <nav class="mdl-navigation">
      <a class="mdl-navigation__link" href="/">Home</a>
      <a class="mdl-navigation__link" href="/about/">About</a>
      <label id="switch-notif" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect blog-notif-switch" for="switch-notif-input">
        <input type="checkbox" id="switch-notif-input" class="mdl-checkbox__input" disabled>
        <span class="mdl-checkbox__label">Notifications</span>
      </label>
      <!--label id="switch-notif" class="mdl-switch mdl-js-switch mdl-js-ripple-effect blog-notif-switch" for="switch-notif-input">
        <input id="switch-notif-input" type="checkbox"  class="mdl-switch__input">
        <span id="switch-notif-label" class="mdl-switch__label">Notifications</span>
      </label-->
    </nav>
  </div>
  

      <main class="mdl-layout__content">
        
        <section class="section--center mdl-grid mdl-grid--no-spacing mdl-shadow--2dp" style="margin-top: 18px; margin-bottom: 18px">
	      <div class="mdl-card mdl-cell mdl-cell--12-col">
	        <div class="mdl-card__supporting-text">
	          <h4>The Greedy Cave</h4>
            
            <a href="/assets/images/greedy_cave/tgc.gif" onclick="screenshotOnClick(1);return false;" target="_blank"><img src="/assets/images/greedy_cave/tgc.gif" alt="Gameplay gif" class="top_gif gameScreenshotSmall"></a>
            
	          <p><em>The Greedy Cave</em> is an <a href="https://en.wikipedia.org/wiki/Action_role-playing_game" target="_blank">ARPG</a>. Ready your spells, sharpen your swords, boost your stats, enchant your equipement, study your enemies and beat the crap out of that dungeon !! If you like <a href="https://en.wikipedia.org/wiki/Diablo_(video_game)" target="_blank">Diablo</a> or <a href="http://store.steampowered.com/app/200710/" target="_blank">Torchlight</a>, the greedy cave is made for you !<!--more--></p>

<p>In this mobile game you explore dungeon, <strong>try not to die</strong>, and decimate your enemies ! On your way you’ll:</p>

<ul>
  <li><strong>Increase your attributs</strong>: Luck, defense, attack, dodge, crit, …</li>
  <li><strong>Learn skills</strong>: Forcefield, “Slice in two”, Telekenesis, …</li>
  <li><strong>Enchant equipment</strong>: Fire/water/dark/[…] attack, penetrate, life/mana regen, extra xp/gold, …</li>
  <li><strong>strengthen your equipement</strong>: increase its natural stats with the black-smith help </li>
</ul>

<p>After exploring the (procedural) dungeon you will go back to the town where you’ll have the surprise to meet with other real players (^_^). No <strong>it’s not an mmorpg</strong>, and you can’t interact with them but you can look at their stats and equipement and it’s actually super useful to give you an idea of combos etc.</p>

<p>The art style is quite similar to <a href="https://www.kleientertainment.com/games/dont-starve" target="_blank">Don’t Starve</a>, it’s really pleasant. My only complain is that sometime, as we are in a dungeon, the screen is a bit dark and it make it hard to play in a bright environement. Thank god I live in London, the sun doesn’t come down here too often (^_^).</p>

<p>The game is <strong>free to play</strong> with <strong>no ads</strong> (apart from rewarded videos) and frankly the current, virtual currency based, monetisation doesn’t require you to pay at all from my experience (and I’m fairly advanced in the game). It’s unfortunate for the game dev that musn’t have that much revenue right now (-_-). I wish the game had more long lasting upgrades. Uou can purchase equipement and short boost of XP/gold etc. But in the end equipment become obsolete (I mean after a couple fo levels you’ll find better equipement) and boost last only for so long. After that I would feel like I just threw money out of the window. I’d rather purchase stuff that is more expensive but last forever.</p>

<p>If I had 3 wishes their would be:</p>

<ul>
  <li><strong>More long lasting upgrades</strong>! Get me a pet, a new building in town, a glowing aura, dragon blood in my heritage, I don’t care what, but something that last forever !</li>
  <li><strong>Side gameplay</strong>! Exploring dungeon is great, but in Final Fantasy you had the <a href="https://www.youtube.com/watch?v=Tfa5Oqy88QE" target="_blank">chocobo race</a> don’t break out of the routine, what about a side game here too ? Plus it could have it’s own leaderboard for competition too (^_^)</li>
  <li><strong>Referal</strong> I have plenty of friends that would love that game and while I’ll hopefully convince them to try it, a referal bonus would be great: “Invite a friend, your friend get a starter armor for free and when he reach level 6 you get XXXXX”</li>
</ul>

<p>The Greedy Cave is made by <a href="http://www.avalongames.com" target="_blank">Avalon Games</a>, a Chinese studio based in Chengdu. Althought I couldn’t find the credit in the game it feel like an indie game (made with <a href="http://www.cocos2d-x.org/" target="_blank">Cocos 2dx</a>).</p>

            
            <div class="store_badges">
            <a href="https://play.google.com/store/apps/details?id=com.avalon.cave" target="_blank"><img src="/assets/images/play_badge.png" alt="Get it on Google Play" class="play_badge"/></a>
            <a href="https://itunes.apple.com/gb/app/the-greedy-cave/id1028950091" target="_blank"><img src="/assets/images/apple_badge.svg" alt="Download on the App Store" class="apple_badge"/></a>
            </div>
            
            
            <div class="mdl-grid">
              
                <div class="mdl-cell mdl-cell--4-col">
                  <a href="/assets/images/greedy_cave/screenshot_0.png" onclick="screenshotOnClick(2);return false;" target="_blank"><picture>
                    <source type="image/webp" srcset="/assets/images/greedy_cave/screenshot_0_small.png.webp">
                    <img src="/assets/images/greedy_cave/screenshot_0_small.png" alt="Screenshot" width="100%" class="gameScreenshotSmall">
                  </picture><!--img src="/assets/images/greedy_cave/screenshot_0_small.png" alt="Screenshot" width="100%" class="gameScreenshotSmall"/--></a>
                </div>
              
                <div class="mdl-cell mdl-cell--4-col">
                  <a href="/assets/images/greedy_cave/screenshot_1.png" onclick="screenshotOnClick(3);return false;" target="_blank"><picture>
                    <source type="image/webp" srcset="/assets/images/greedy_cave/screenshot_1_small.png.webp">
                    <img src="/assets/images/greedy_cave/screenshot_1_small.png" alt="Screenshot" width="100%" class="gameScreenshotSmall">
                  </picture><!--img src="/assets/images/greedy_cave/screenshot_1_small.png" alt="Screenshot" width="100%" class="gameScreenshotSmall"/--></a>
                </div>
              
                <div class="mdl-cell mdl-cell--4-col">
                  <a href="/assets/images/greedy_cave/screenshot_2.png" onclick="screenshotOnClick(4);return false;" target="_blank"><picture>
                    <source type="image/webp" srcset="/assets/images/greedy_cave/screenshot_2_small.png.webp">
                    <img src="/assets/images/greedy_cave/screenshot_2_small.png" alt="Screenshot" width="100%" class="gameScreenshotSmall">
                  </picture><!--img src="/assets/images/greedy_cave/screenshot_2_small.png" alt="Screenshot" width="100%" class="gameScreenshotSmall"/--></a>
                </div>
              
                <div class="mdl-cell mdl-cell--4-col">
                  <a href="/assets/images/greedy_cave/screenshot_3.png" onclick="screenshotOnClick(5);return false;" target="_blank"><picture>
                    <source type="image/webp" srcset="/assets/images/greedy_cave/screenshot_3_small.png.webp">
                    <img src="/assets/images/greedy_cave/screenshot_3_small.png" alt="Screenshot" width="100%" class="gameScreenshotSmall">
                  </picture><!--img src="/assets/images/greedy_cave/screenshot_3_small.png" alt="Screenshot" width="100%" class="gameScreenshotSmall"/--></a>
                </div>
              
              </div>
            
	        </div>
	      </div>
	    </section> 
        

        
<footer class="mdl-mega-footer">
  <div class="mdl-mega-footer__middle-section">

    <div class="mdl-mega-footer__drop-down-section">
      <input class="mdl-mega-footer__heading-checkbox" type="checkbox" checked>
      <h1 class="mdl-mega-footer__heading">Informations</h1>
      <ul class="mdl-mega-footer__link-list">
        <li><a class="footer_link" href="#">License</a></li>
        <li><a class="footer_link" href="mailto:your-email@domain.com">Send an email</a></li>
      </ul>
    </div>

    <!--div class="mdl-mega-footer__drop-down-section">
      <input class="mdl-mega-footer__heading-checkbox" type="checkbox" checked>
      <h1 class="mdl-mega-footer__heading">Details</h1>
      <ul class="mdl-mega-footer__link-list">
        <li><a href="#">Specs</a></li>
        <li><a href="#">Tools</a></li>
        <li><a href="#">Resources</a></li>
      </ul>
    </div-->

    <div class="mdl-mega-footer__drop-down-section">
      <input class="mdl-mega-footer__heading-checkbox" type="checkbox" checked>
      <h1 class="mdl-mega-footer__heading">Social</h1>
      <ul class="mdl-mega-footer__link-list">
        
          <li>
            <a class="footer_link" href="https://plus.google.com/+DamienMABIN" target="_blank">
              <span>
                <svg style="fill: #ff0000;" height="16px" id="Layer_1" version="1.1" viewBox="0 0 128 128" width="16px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle cx="64" cy="64" fill="#9e9e9e" r="64"/><g><path fill="#424242" d="M49.424,97.875c-19.018,0-34.491-15.193-34.491-33.874c0-18.68,15.473-33.875,34.491-33.875     c8.318,0,16.354,2.952,22.624,8.309l-8.771,9.899c-3.838-3.279-8.758-5.086-13.853-5.086c-11.652,0-21.13,9.31-21.13,20.752     c0,11.441,9.479,20.75,21.13,20.75c9.858,0,16.311-4.723,18.407-13.197H49.587V58.432h32.347v6.562     C81.934,84.659,68.869,97.875,49.424,97.875z"/></g><polygon fill="#424242" points="117.934,58.438 107.934,58.438 107.934,48.438 99.934,48.438 99.934,58.438 89.934,58.438     89.934,66.438 99.934,66.438 99.934,76.438 107.934,76.438 107.934,66.438 117.934,66.438   "/></g>
                </svg>
              </span>
              <span>+DamienMabin</span>
            </a>
          </li>
          

          
          <li>
            <a class="footer_link" href="https://twitter.com/yindie" target="_blank">
                <svg viewBox="0 0 16 16" height="16px" width="16px">
                  <path fill="#9e9e9e" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              <span class="username">yindie</span>
            </a>
          </li>
          
      </ul>
    </div>

    <!-- div class="mdl-mega-footer__drop-down-section">
      <input class="mdl-mega-footer__heading-checkbox" type="checkbox" checked>
      <h1 class="mdl-mega-footer__heading">FAQ</h1>
      <ul class="mdl-mega-footer__link-list">
        <li><a href="#">Questions</a></li>
        <li><a href="#">Answers</a></li>
        <li><a href="#">Contact us</a></li>
      </ul>
    </div -->

  </div>

  <!-- div class="mdl-mega-footer__bottom-section">
    <div class="mdl-logo">Title</div>
    <ul class="mdl-mega-footer__link-list">
      <li><a href="#">Help</a></li>
      <li><a href="#">Privacy & Terms</a></li>
    </ul>
  </div -->

</footer>

      </main>
      </div>

      <!-- Root element of PhotoSwipe. Must have class pswp. -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

      <!-- Background of PhotoSwipe. 
           It's a separate element as animating opacity is faster than rgba(). -->
      <div class="pswp__bg"></div>
      <!-- Slides wrapper with overflow:hidden. -->
      <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
        PhotoSwipe keeps only 3 of them in the DOM to save memory.
        Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
          <div class="pswp__top-bar">
            <!--  Controls are self-explanatory. Order can be changed. -->
            <div class="pswp__counter"></div>
            <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
            <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
            <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
            <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
            <!-- element will get class pswp__preloader--active when preloader is running -->
            <div class="pswp__preloader">
              <div class="pswp__preloader__icn">
                <div class="pswp__preloader__cut">
                  <div class="pswp__preloader__donut"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
            <div class="pswp__share-tooltip"></div> 
          </div>
          <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
          <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"> </button>
          <div class="pswp__caption">
            <div class="pswp__caption__center"></div>
          </div>
        </div>
      </div>
    </div>

    
    <script>
      var items = [];

      Modernizr.on('webp', function (result) {
        // result == Modernizr.webp either is either `true` or `false`
        var extension = ".png";
        console.log("webp support: " + result);
        if (result == true) {
          // Has WebP support
          extension = ".png.webp";
        }
        console.log("extension: " + extension);

        // build items array
        items = [
            
            {
                src: '/assets/images/greedy_cave/tgc.gif',
                
                
                w: 371,
                h: 376,
                msrc: '/assets/images/greedy_cave/tgc.gif'
            },
            
            
            {
                src: '/assets/images/greedy_cave/screenshot_0' + extension,
                
                
                w: 1440,
                h:  2560,
                msrc: '/assets/images/greedy_cave/screenshot_0_small' + extension
            },
            
            {
                src: '/assets/images/greedy_cave/screenshot_1' + extension,
                
                
                w: 1440,
                h:  2560,
                msrc: '/assets/images/greedy_cave/screenshot_1_small' + extension
            },
            
            {
                src: '/assets/images/greedy_cave/screenshot_2' + extension,
                
                
                w: 1440,
                h:  2560,
                msrc: '/assets/images/greedy_cave/screenshot_2_small' + extension
            },
            
            {
                src: '/assets/images/greedy_cave/screenshot_3' + extension,
                
                
                w: 1440,
                h:  2560,
                msrc: '/assets/images/greedy_cave/screenshot_3_small' + extension
            },
            
        ];
      });
      
      

      var pswpElement = document.querySelectorAll('.pswp')[0];

      function screenshotOnClick(imgId) {
        // define options (if needed)
        var options = {
            // optionName: 'option value'
            // for example:
            index: imgId-1,
            getThumbBoundsFn: function(index) {

                // find thumbnail elements
                var thumbnail = document.getElementsByClassName('gameScreenshotSmall')[index];

                // get window scroll Y
                var pageYScroll = window.pageYOffset || document.documentElement.scrollTop; 
                // optionally get horizontal scroll

                // get position of element relative to viewport
                var rect = thumbnail.getBoundingClientRect(); 

                // w = width
                return {x:rect.left, y:rect.top + pageYScroll, w:rect.width};


                // Good guide on how to get element coordinates:
                // http://javascript.info/tutorial/coordinates
            }
        };

        // Initializes and opens PhotoSwipe
        var gallery = new PhotoSwipe( pswpElement, PhotoSwipeUI_Default, items, options);
        gallery.init();
      }

    </script>
    

    <script type="text/javascript">
      function downloadJSAtOnload() {
        var element = document.createElement("script");
        element.src = "/css/photoswipe/photoswipe.min.js";
        document.body.appendChild(element);
        element = document.createElement("script");
        element.src = "/css/photoswipe/photoswipe-ui-default.min.js";
        document.body.appendChild(element);
      }
      if (window.addEventListener)
        window.addEventListener("load", downloadJSAtOnload, false);
      else if (window.attachEvent)
        window.attachEvent("onload", downloadJSAtOnload);
      else
        window.onload = downloadJSAtOnload;
    </script>
    <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBaKSt8JOUUokXd4vzVwg7covsTpzNM5jo",
    authDomain: "luminous-inferno-9971.firebaseapp.com",
    databaseURL: "https://luminous-inferno-9971.firebaseio.com",
    storageBucket: "luminous-inferno-9971.appspot.com",
  };
  firebase.initializeApp(config);

  console.log("navigator.language: " + navigator.language);
  var isPushEnabled = false;
  var pushNotifToken;
  var pushNotifEndPoint;

  function initialiseState() {
    console.log('initialiseState');
    // Are Notifications supported in the service worker?  
    if (!('showNotification' in ServiceWorkerRegistration.prototype)) {  
      console.warn('Notifications aren\'t supported.');  
      return;  
    }

    // Check the current Notification permission.  
    // If its denied, it's a permanent block until the  
    // user changes the permission  
    if (Notification.permission === 'denied') {
      console.warn('The user has blocked notifications.');
      return;
    }

    // Check if push messaging is supported  
    if (!('PushManager' in window)) {
      console.warn('Push messaging isn\'t supported.');
      return;
    }

    console.log("check for a subscription ");
    // We need the service worker registration to check for a subscription  
    navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
      console.log("service worker is ready");
      // Do we already have a push message subscription?
      serviceWorkerRegistration.pushManager.getSubscription()
        .then(function(subscription) {
          console.log("enable ui");
          // Enable any UI which subscribes / unsubscribes from
          // push messages.
          var pushButton = document.querySelector('#switch-notif');
          pushButton.MaterialCheckbox.enable();

          if (!subscription) {
            // We aren't subscribed to push, so set UI  
            // to allow the user to enable push
            console.log("enable ui");
            //pushButton.checked = false;
            pushButton.MaterialCheckbox.uncheck();

            setTimeout(displaySnackBar,3000);

            return;  
          }

          pushButton.MaterialCheckbox.check();
          //pushButton.checked = true;

          // Keep your server in sync with the latest subscriptionId
          sendSubscriptionToServer(subscription);

          // Set your UI to show they have subscribed for
          // push messages
          //pushButton.textContent = 'Disable Push Messages';
          isPushEnabled = true;
        })  
        .catch(function(err) {
          console.warn('Error during getSubscription()', err);
        });
    });  
  }

  function snackbarHandler() {
    var snck = document.getElementById("demo-snackbar-example");
    //snck.style.display = "none";
    snck.classList.remove('mdl-snackbar--active');
    subscribe();
  }

  function displaySnackBar() {
    var snackbarContainer = document.querySelector('#demo-snackbar-example');
    if(snackbarContainer) {
      var data = {
        message: 'Stay in touch ! Subscribe to notification (^_^)',
        timeout: 8000,
        actionHandler: snackbarHandler,
        actionText: 'Subscribe'
      };
      snackbarContainer.MaterialSnackbar.showSnackbar(data);
    }
  }

  function sendSubscriptionToServer(subscription) {
    var timeOffset = new Date().getTimezoneOffset();
    pushNotifEndPoint = subscription.endpoint;
    if(subscription.endpoint.startsWith("https://android.googleapis.com/gcm/send/")) {
      pushNotifToken = subscription.endpoint.substring("https://android.googleapis.com/gcm/send/".length);
      console.log("push token: " + pushNotifToken);
      var wilmaRef = firebase.database().ref('pntokens/'+pushNotifToken);
      wilmaRef.set({platform: "chrome", topic: "games", token: pushNotifToken, time_offset: timeOffset, endpoint: pushNotifEndPoint});
    } else if (subscription.endpoint.startsWith("https://updates.push.services.mozilla.com/push/")) {
      pushNotifToken = subscription.endpoint.substring("https://updates.push.services.mozilla.com/push/".length);
      console.log("push token: " + pushNotifToken);
      var wilmaRef = firebase.database().ref('pntokens/'+pushNotifToken);
      wilmaRef.set({platform: "firefox", topic: "games", token: pushNotifToken, time_offset: timeOffset, endpoint: pushNotifEndPoint});
    } else {
      console.log("Unknown pusk token type: " + subscription.endpoint);
    }
    var pnTokenElt = document.getElementById('div_pn_token');
    if(pnTokenElt) {
      pnTokenElt.innerHTML = pushNotifToken;
    }

    var pnEndpointElt = document.getElementById('div_pn_endpoint');
    if(pnEndpointElt) {
      pnEndpointElt.innerHTML = pushNotifEndPoint;
    }
  }

  function subscribe() {  
    // Disable the button so it can't be changed while  
    // we process the permission request  
    var pushButton = document.querySelector('#switch-notif');  
    //pushButton.disabled = true;
    pushButton.MaterialCheckbox.disable();

    navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {  
      serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly: true})  
        .then(function(subscription) {  
          // The subscription was successful  
          isPushEnabled = true;  
          //pushButton.textContent = 'Disable Push Messages';  
          //pushButton.disabled = false;
          pushButton.MaterialCheckbox.enable();
          pushButton.MaterialCheckbox.check();

          // TODO: Send the subscription.endpoint to your server  
          // and save it to send a push message at a later date
          return sendSubscriptionToServer(subscription);  
        })  
        .catch(function(e) {  
          if (Notification.permission === 'denied') {  
            // The user denied the notification permission which  
            // means we failed to subscribe and the user will need  
            // to manually change the notification permission to  
            // subscribe to push messages  
            console.warn('Permission for Notifications was denied');  
            //pushButton.disabled = true;
            pushButton.MaterialCheckbox.disable();
          } else {  
            // A problem occurred with the subscription; common reasons  
            // include network errors, and lacking gcm_sender_id and/or  
            // gcm_user_visible_only in the manifest.  
            console.error('Unable to subscribe to push.', e);  
            //pushButton.disabled = false;
            pushButton.MaterialCheckbox.enable();
          pushButton.MaterialCheckbox.uncheck();
            //pushButton.textContent = 'Enable Push Messages';  
          }  
        });  
    });  
  }

  function unsubscribe() {  
    var pushButton = document.querySelector('#switch-notif');
    //pushButton.disabled = true;
    pushButton.MaterialCheckbox.disable();

    navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
      // To unsubscribe from push messaging, you need get the
      // subscription object, which you can call unsubscribe() on.
      serviceWorkerRegistration.pushManager.getSubscription().then(
        function(subscription) {
          // Check we have a subscription to unsubscribe
          if (!subscription) {
            // No subscription object, so set the state
            // to allow the user to subscribe to push
            isPushEnabled = false;
            //pushButton.disabled = false;
            pushButton.MaterialCheckbox.enable();
            pushButton.MaterialCheckbox.uncheck();
            //pushButton.textContent = 'Enable Push Messages';
            return;
          }

          if(subscription.endpoint.startsWith("https://android.googleapis.com/gcm/send/")) {
            // This is a chrome push
            var endpoint = subscription.endpoint;
            // Make a request to your server to remove
            // the subscriptionId from your data store so you
            // don't attempt to send them push messages anymore
            var pntoken = endpoint.substring("https://android.googleapis.com/gcm/send/".length);
            console.log("push token: " + pntoken);
            var onComplete = function(error) {
              if (error) {
                console.log('Synchronization failed');
              } else {
                console.log('Synchronization succeeded');
              }
            };
            var dataRef = firebase.database().ref('pntokens/'+pntoken);
            dataRef.remove(onComplete);

            // We have a subscription, so call unsubscribe on it
            subscription.unsubscribe().then(function(successful) {
              //pushButton.disabled = false;
              pushButton.MaterialCheckbox.enable();
              pushButton.MaterialCheckbox.uncheck();
              //pushButton.textContent = 'Enable Push Messages';
              isPushEnabled = false;
            }).catch(function(e) {
              // We failed to unsubscribe, this can lead to
              // an unusual state, so may be best to remove
              // the users data from your data store and
              // inform the user that you have done so

              console.log('Unsubscription error: ', e);
              //pushButton.disabled = false;
              pushButton.MaterialCheckbox.enable();
              //pushButton.textContent = 'Enable Push Messages';
            });
          } else if (subscription.endpoint.startsWith("https://updates.push.services.mozilla.com/push/")) {
            // This is a firefox push
            var endpoint = subscription.endpoint;
            // Make a request to your server to remove
            // the subscriptionId from your data store so you
            // don't attempt to send them push messages anymore
            var pntoken = endpoint.substring("https://updates.push.services.mozilla.com/push/".length);
            console.log("push token: " + pntoken);
            var onComplete = function(error) {
              if (error) {
                console.log('Synchronization failed');
              } else {
                console.log('Synchronization succeeded');
              }
            };
            var dataRef = firebase.database().ref('pntokens/'+pntoken);
            dataRef.remove(onComplete);

            // We have a subscription, so call unsubscribe on it
            subscription.unsubscribe().then(function(successful) {
              //pushButton.disabled = false;
              pushButton.MaterialCheckbox.enable();
              pushButton.MaterialCheckbox.uncheck();
              //pushButton.textContent = 'Enable Push Messages';
              isPushEnabled = false;
            }).catch(function(e) {
              // We failed to unsubscribe, this can lead to
              // an unusual state, so may be best to remove
              // the users data from your data store and
              // inform the user that you have done so

              console.log('Unsubscription error: ', e);
              //pushButton.disabled = false;
              pushButton.MaterialCheckbox.enable();
              //pushButton.textContent = 'Enable Push Messages';
            });
          } else {
            console.log("Unknown pusk token type: " + subscription.endpoint);
          }
        }).catch(function(e) {  
          console.error('Error thrown while unsubscribing from push messaging.', e);  
        });  
    });  
  }

  window.addEventListener('load', function() {
    var pushButton = document.getElementById('switch-notif');
    pushButton.addEventListener('click', function() {
      if (isPushEnabled) {
        console.log("unsubscribe()");
        unsubscribe();
      } else {
        console.log("subscribe()");
        subscribe();
      }
    });

    var pushSectionButton = document.getElementById('button-notif-subscribe');
    if (pushSectionButton) {
      pushSectionButton.addEventListener('click', function() {
        console.log("subscribe()");
        subscribe();
      });
    }

    // Check that service workers are supported, if so, progressively  
    // enhance and add push messaging support, otherwise continue without it.  
    if ('serviceWorker' in navigator) {
      console.log("serviceWorker in navigator");
      navigator.serviceWorker.register('/service-worker.js')
      .then(initialiseState);
    } else {
      console.warn('Service workers aren\'t supported in this browser.');
    }
  });
</script>

    <script asynch src="/scripts/material.min.js"></script>
    <link rel="stylesheet" href="/css/merged.min.css">
  </body>

  <!--div id="target-modal" class="rv-vanilla-modal">
    <div class="rv-vanilla-modal-header group">
      <button class="rv-vanilla-modal-close"><span class="text">×</span></button>
      <h2 class="rv-vanilla-modal-title">Modal Title</h2>
    </div>
    <div class="rv-vanilla-modal-body">
      <p>Modal Content</p>
    </div>
  </div-->
  <!--script src="/scripts/rv-vanilla-modal.min.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    /* global RvVanillaModal */
    'use strict';
    var modal = new RvVanillaModal({
        showOverlay: true
    });

    // each method
    modal.each(function(element) {
       var target = element.getAttribute('data-rv-vanilla-modal');
       var targetElement = document.querySelector(target);
       var closeBtn = targetElement.querySelector(modal.settings.closeSelector);

       // close click listerner
       closeBtn.addEventListener('click', function(event) {
        event.preventDefault();
        modal.close(targetElement);
       });

       // open click listerner
       element.addEventListener('click', function(event) {
        event.preventDefault();
        modal.open(targetElement);
       });
    });
  }, false);
  </script-->

</html>


