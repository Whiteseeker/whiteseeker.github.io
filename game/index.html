<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="A front-end template that helps you build fast, modern mobile web apps.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Blog</title>

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" sizes="192x192" href="/assets/images/icon_192_192.png">
  <link rel="manifest" href="/manifest.json">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Material Design Lite">
  <link rel="apple-touch-icon-precomposed" href="/assets/images/icon_192_192.png">

  <!-- Tile icon for Win8 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
  <meta name="msapplication-TileColor" content="#3372DF">

  <meta name="theme-color" content="#3F51B5">
  <link rel="shortcut icon" href="/assets/images/favicon.png">

  <meta name="google-site-verification" content="G5DNU81K0TiZ4pd6NaBXaUwv0XgI_bI7NHlaMymkrN8" />
  <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
  <link rel="canonical" href="https://whiteseeker.github.io/game/index.html">

  <link rel="stylesheet" href="/css/critical.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  
  
      
       <link rel="stylesheet" href="/game/game.css">
         
  

  <!-- Google Analytics -->
  <script>
  var host = "whiteseeker.github.io";
  if ((host == window.location.host) && (window.location.protocol != "https:"))
      window.location.protocol = "https";
  
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-70962121-1', {'siteSpeedSampleRate': 40});
  ga('send', 'pageview');
  </script>
  <script async src='//www.google-analytics.com/analytics.js'></script>
  <script src="/scripts/modernizr-custom.min.js"></script>
  <!-- End Google Analytics -->

</head>


  <body class="mdl-demo mdl-color--grey-100 mdl-color-text--grey-700 mdl-base">
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <main class="mdl-layout__content">
        
        <canvas class="game-canvas" id="glcanvas" touch-action="none">
  Your browser doesn't appear to support the 
  <code>&lt;canvas&gt;</code> element.
</canvas>

<button id="button_option" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-js-ripple-effect">
  <i class="material-icons">settings</i>
</button>

<div id="money" class="noselect">
  <div id="money_amount">0</div>
  <div id="money_unit">$</div>
</div>

<div id="bottom-tabs" class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
  <div class="mdl-tabs__tab-bar">
    <a href="#powers" class="mdl-tabs__tab is-active">Powers</a>
    <a href="#musicians" class="mdl-tabs__tab">Musicians</a>
    <!--a href="#jokers" class="mdl-tabs__tab">Jokers</a-->
  </div>
  <div class="mdl-tabs__panel is-active" id="powers">
    <div class="power-list-action mdl-list">
  <div class="mdl-list__item">
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Euterpe's charm</span>
    </span>
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      Use
    </button>
    <!--a class="mdl-list__item-secondary-action" href="#"><i class="material-icons">star</i></a-->
  </div>
  <div class="mdl-list__item">
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Super prod</span>
    </span>
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      Use
    </button>
  </div>
  <div class="mdl-list__item">
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Telekinesis</span>
    </span>
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      Use
    </button>
  </div>
  <div class="mdl-list__item">
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Alpha waves</span>
    </span>
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      Use
    </button>
  </div>
</div>
  </div>
  <div class="mdl-tabs__panel" id="musicians">
    <div class="musicians-list-action mdl-list">
  <div class="mdl-list__item">
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Piano</span>
    </span>
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
    <!--a class="mdl-list__item-secondary-action" href="#"><i class="material-icons">star</i></a-->
  </div>
  <div class="mdl-list__item">
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Violin</span>
    </span>
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
  </div>
  <div class="mdl-list__item">
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Cello</span>
    </span>
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
  </div>
  <div class="mdl-list__item">
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Triangle</span>
    </span>
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
  </div>
  <div class="mdl-list__item">
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <div style="display:block;">
        <span>Tambour</span><span>Lvl 0</span>
        <span>Give <span>0</span> skill/second (+<span>5</span>)</span>
      </div>
    </span>
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div>
          <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
        <div style="line-height: normal;">Upgrade</div>
      </div>
    </button>
  </div>
  <div class="mdl-list__item">
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Bass</span>
    </span>
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
  </div>
  <div class="mdl-list__item">
    <span class="mdl-list__item-primary-content">
      <i class="material-icons mdl-list__item-avatar">person</i>
      <span>Cor</span>
    </span>
    <button class="upgrade-button mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      <div class="upgrade-amount" style="display:inline;">150</div><div class="upgrade-unit"style="display:inline;">$</div><br/>
      <div style="line-height: normal;">Upgrade</div>
    </button>
  </div>
</div>
  </div>
  <!-- div class="mdl-tabs__panel" id="jokers">
    lili
  </div-->
</div>

<div id="spinner-background">
  <div id="game-spinner" class="mdl-spinner mdl-js-spinner is-active"></div>
</div>

<dialog class="mdl-dialog" id="modal-option">
  <div class="mdl-dialog__content">
  <div class="option-list-action mdl-list">
    <div class="mdl-list__item">
      <span class="mdl-list__item-primary-content">
        <span>Account</span>
      </span>
      <button id="button_account" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
        Details
      </button>
    </div>
    <div class="mdl-list__item">
      <span class="mdl-list__item-primary-content">
        <span>Notification</span>
      </span>
      <a class="mdl-list__item-secondary-action" href="#">
        <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="opt-switch-notif">
          <input type="checkbox" id="opt-switch-notif" class="mdl-switch__input" disabled>
          <span class="mdl-switch__label"></span>
        </label>
      </a>
    </div>
    <div class="mdl-list__item">
      <span class="mdl-list__item-primary-content">
        <span>Sound</span>
      </span>
      <a class="mdl-list__item-secondary-action" href="#">
        <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-sound">
          <input type="checkbox" id="switch-sound" class="mdl-switch__input">
          <span class="mdl-switch__label"></span>
        </label>
      </a>
    </div>
  </div>
</div>
<div class="mdl-dialog__actions mdl-dialog__actions--full-width">
  <button id="button_close" type="button" class="mdl-button">Close</button>
</div>
</dialog>

<dialog class="mdl-dialog" id="modal-login">
  <div class="mdl-dialog__content">

  <div id="not-signed" class="option-list-action mdl-list">
    <div class="mdl-list__item">
      <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" id="button_google">
        Google sign-in
      </button>
    </div>
    <div class="mdl-list__item">
      <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" id="button_anon">
        Continue as anonymous
      </button>
    </div>
  </div>

  <div id="google-signed" class="option-list-action mdl-list">
    <div class="mdl-list__item">
      <div class="mdl-list__item-primary-content">
          <span>
            You are connected with your google account: 
            <span id="google-email">email</span>
          </span>
      </div>
    </div>
  </div>

  <div id="anon-signed" class="option-list-action mdl-list">
    <div class="mdl-list__item">
      <span class="mdl-list__item-primary-content">
          You are connected as anonymous. Link an account to avoid loosing your progress (^_^).
      </span>
    </div>
    <div class="mdl-list__item">
      <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" id="button_link_google">
        Link a Google account
      </button>
    </div>
  </div>

  <div id="signed-buttons">
    <button class="button_logout mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      Logout
    </button>
    <button class="button_close mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      close
    </button>
  </div>

</div>

</dialog>

<script type="text/javascript" src="/scripts/glMatrix-2.3.2.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase.js"></script>
<script src="https://code.jquery.com/pep/0.4.1/pep.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBKKsD6yJWKlApefX-ii-RlQ0ccnz4oSis",
    authDomain: "lirtition.firebaseapp.com",
    databaseURL: "https://lirtition.firebaseio.com",
    storageBucket: "lirtition.appspot.com",
  };
  firebase.initializeApp(config);
</script>

<script id="shader-fs" type="x-shader/x-fragment">
  precision mediump float;

  void main(void) {
    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
  }
</script>

<script id="shader-vs" type="x-shader/x-vertex">
  attribute vec3 aVertexPosition;

  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;

  void main(void) {
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
  }
</script>

<script type="text/javascript">


  /* ------ START Global var ------ */
  var gl;
  var canvas;
  var money = 0;
  var moneyTF;
  var cbs;
  var loginDialog;
  var optionDialog;
  var uid = undefined;
  /* ------ END Global var ------ */

  function initWebGL(canvas) {
    var res = null;
    
    try {
      // Try to grab the standard context. If it fails, fallback to experimental.
      res = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
    }
    catch(e) {}
    
    // If we don't have a GL context, give up now
    if (!res) {
      alert("Unable to initialize WebGL. Your browser may not support it.");
      res = null;
    }
    
    return res;
  }

  function loadGameData() {
    var user = firebase.auth().currentUser;
    uid = user.uid;
    console.log("User uid: " + uid);


    var isLoaded = false;
    listeners = firebase.database().ref('/' + uid + '/game/').on('value', function(snapshot) {
      if(!isLoaded) {
        isLoaded = true;
        loadingScreen(false, false); // Remove loading screen
      }
      if(snapshot.val().money > money) {
        money = snapshot.val().money;
        moneyTF.innerHTML = money; 
      }
    });
  }

  function unloadGameData() {
    var isLoaded = false;

    money = 0;
    moneyTF.innerHTML = 0;

    firebase.database().ref('/' + uid + '/game/').off('value', cbs);

    uid = undefined;
  }

  function addMoney(amount) {
    money+=amount;
    moneyTF.innerHTML = money; 

    firebase.database().ref('/' + uid + '/game/').set({
      money: money
    });
  }

  function loadingScreen(background, spinner) {
    if(background) {
      document.getElementById("spinner-background").style.display = "flex";
    } else {
      document.getElementById("spinner-background").style.display = "none";
    }

    if(spinner) {
      document.getElementById("game-spinner").className += " is-active";
    } else {
      document.getElementById("game-spinner").className =
        document.getElementById("game-spinner").className.replace(/\bis-active\b/,'');
    }
  }

  function showLoginModal(show) {
    var sub_menu_not_signed = document.getElementById("not-signed");
    var sub_menu_google_signed = document.getElementById("google-signed");
    var sub_menu_anon_signed = document.getElementById("anon-signed");
    var signed_buttons = document.getElementById("signed-buttons");

    if(show) {
      var user = firebase.auth().currentUser;
      if(user != null) {
        // var name = user.displayName;
        // var email = user.email;
        // var photoUrl = user.photoURL;
        // var uid = user.uid;
        console.log("length: " + user.providerData.length);
        var googleEmail = undefined;
        user.providerData.forEach(function (profile) {
          if(profile.providerId == "google.com") {
            googleEmail = profile.email;
          }
        });
        if(googleEmail != undefined) {
          document.getElementById("google-email").innerHTML = googleEmail;
          sub_menu_not_signed.style.display = "none";
          sub_menu_google_signed.style.display = "block";
          sub_menu_anon_signed.style.display = "none";
        } else {
          sub_menu_not_signed.style.display = "none";
          sub_menu_google_signed.style.display = "none";
          sub_menu_anon_signed.style.display = "block";
        }
        signed_buttons.style.display = "block";
      } else {
        // User is null, we ask to sign:
        sub_menu_not_signed.style.display = "block";
        sub_menu_google_signed.style.display = "none";
        sub_menu_anon_signed.style.display = "none";
        signed_buttons.style.display = "none";
      }
      loginDialog.showModal();
    } else {
      loginDialog.close();
    }
  }

  function start() {

    loadingScreen(true, true);

    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // User is signed in.
        console.log("User is signed in");
        loadGameData();
        showLoginModal(false);
      } else {
        // No user is signed in.
        console.log("User is NOT signed in");
        loadingScreen(true, false); // Remove spinner but keep the dark overlay
        showLoginModal(true);
      }
    });

    canvas = document.getElementById("glcanvas");
    canvas.addEventListener( "pointerdown", function( e ) {
      console.log("pointerdown");
      addMoney(1);
    });
    // Initialize the GL context
    gl = initWebGL(canvas);
    
    // Only continue if WebGL is available and working
    if (gl) {
      // Set clear color to black, fully opaque
      gl.clearColor(0.3, 0.3, 0.3, 1.0);
      // Enable depth testing
      gl.enable(gl.DEPTH_TEST);
      // Near things obscure far things
      gl.depthFunc(gl.LEQUAL);
      // Clear the color as well as the depth buffer.
      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    }
  }

  /* ------ START login modal ------ */
  loginDialog = document.querySelector('#modal-login');
  
  loginDialog.querySelector('#button_google').addEventListener('click', function(evt) {
    var provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithRedirect(provider).then(function(result) {
      // This gives you a Google Access Token. You can use it to access the Google API.
      var token = result.credential.accessToken;
      // The signed-in user info.
      var user = result.user;
      // ...
      showLoginModal(false);
    }).catch(function(error) {
      // Handle Errors here.
      var errorCode = error.code;
      var errorMessage = error.message;
      // The email of the user's account used.
      var email = error.email;
      // The firebase.auth.AuthCredential type that was used.
      var credential = error.credential;
      // ...
    });
  });

  loginDialog.querySelector('#button_anon').addEventListener('click', function(evt) {
    firebase.auth().signInAnonymously().then(function(result) {
      showLoginModal(false);
    }).catch(function(error) {
      // Handle Errors here.
      var errorCode = error.code;
      var errorMessage = error.message;
      // ...
    });
  });

  loginDialog.querySelector('.button_close').addEventListener('click', function(evt) {
    showLoginModal(false);
  });

  loginDialog.querySelector('.button_logout').addEventListener('click', function(evt) {
    firebase.auth().signOut().then(function() {
      showLoginModal(false);
      optionDialog.close();
      unloadGameData();
      loadingScreen(true, false);
      showLoginModal(true);
    });
  });

  /* ------ END login modal ------ */

  /* ------ START option menu ------ */
  optionDialog = document.querySelector('#modal-option');
  /*if (! dialog.showModal) {
      dialogPolyfill.registerDialog(dialog);
  }*/
  optionDialog.querySelector('#button_account').addEventListener('click', function(event) {
      showLoginModal(true);
  });
  document.querySelector('#button_option').addEventListener('click', function(event) {
      optionDialog.showModal();
  });
  optionDialog.querySelector('#button_close').addEventListener('click', function(event) {
      optionDialog.close();
  });
  /* ------ END option menu ------ */

  moneyTF = document.getElementById("money_amount");

  window.onload = start;

</script>



      </main>
    </div>

    <script src="/scripts/material.min.js"></script>
    <link rel="stylesheet" href="/css/merged.min.css">
  </body>

</html>
