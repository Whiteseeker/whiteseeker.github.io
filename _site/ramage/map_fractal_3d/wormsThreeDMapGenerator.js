function randomIntFromInterval(a,e){return Math.floor(Math.random()*(e-a+1)+a)}function generateMap(a){console.log("[worker] Start generating map");var e=a.width,n=a.height,r=a.roughness,t=parseFloat(a.initalt),c=a.seed;console.log("[worker] seed = "+c),Math.seedrandom(c);for(var o=4,d=(Math.floor(e/o),[]),s=0;n*e>s;s++)d[s]=-1;d[0]=t,d[e*n-1]=t,d[e-1]=t,d[e*(n-1)]=t;for(var p=[[[0,0],e-1,n-1,Math.max(1-t,t)-.001]],i=[],m=1,h=2,M=m;p.length+i.length>0;)if(M==m){if(p.length<=0){M=h;continue}var g=p.pop();if(g[1]<=1&&g[2]<=1)continue;var u=g[0],f=g[1],l=g[2],R=g[3],v=R*r,b=[u[0]+f/2,u[1]+l/2],j=ReadMap(d,[u[0],u[1]],e,n);j+=ReadMap(d,[u[0],u[1]+l],e,n),j+=ReadMap(d,[u[0]+f,u[1]+l],e,n),j+=ReadMap(d,[u[0]+f,u[1]],e,n),j/=4,d[b[0]+e*b[1]]=j,d[b[0]+e*b[1]]+=2*R*Math.random()-R,d[b[0]+e*b[1]]<0&&(d[b[0]+e*b[1]]=0),d[b[0]+e*b[1]]>1&&(d[b[0]+e*b[1]]=1);var w={c0:[u[0]+f/2,u[1]+l/2],c1:u,c2:[u[0]+f/2,u[1]-l/2],c3:[u[0]+f,u[1]],randomRange:v};i.push(w);var k={c0:[u[0]+f/2,u[1]+l/2],c1:[u[0]+f,u[1]],c2:[u[0]+f/2+f,u[1]+l/2],c3:[u[0]+f,u[1]+l],randomRange:v};i.push(k);var x={c0:[u[0]+f/2,u[1]+l/2],c1:[u[0]+f,u[1]+l],c2:[u[0]+f/2,u[1]+l/2+l],c3:[u[0],u[1]+l],randomRange:v};i.push(x);var z={c0:[u[0]+f/2,u[1]+l/2],c1:[u[0],u[1]+l],c2:[u[0]+f/2-f,u[1]+l/2],c3:u,randomRange:v};i.push(z)}else if(M==h){if(i.length<=0){M=m;continue}var F=i.pop(),b=[F.c1[0]+(F.c3[0]-F.c1[0])/2,F.c1[1]+(F.c3[1]-F.c1[1])/2],j=ReadMap(d,F.c0,e,n);j+=ReadMap(d,F.c1,e,n),j+=ReadMap(d,F.c2,e,n),j+=ReadMap(d,F.c3,e,n),j/=4,d[b[0]+e*b[1]]=j,d[b[0]+e*b[1]]+=2*F.randomRange*Math.random()-F.randomRange,d[b[0]+e*b[1]]<0&&(d[b[0]+e*b[1]]=0),d[b[0]+e*b[1]]>1&&(d[b[0]+e*b[1]]=1);var G=GetUpperLeft(F),I=Math.abs(F.c0[0]-F.c1[0]),L=Math.abs(F.c0[1]-F.c1[1]);I+L>1&&p.push([G,I,L,F.randomRange])}for(var s=0;n*e>s;s++)d[s]*=255;postMessage({type:"Result",data:d})}function GetUpperLeft(a){return[Math.min(a.c0[0],a.c1[0]),Math.min(a.c0[1],a.c1[1])]}function ReadMap(a,e,n,r){var t=sanetize(e,n,r);return a[t[0]+n*t[1]]}function sanetize(a,e,n){var r=[];return a[0]<0?r[0]=e+(a[0]-1):a[0]>=e?r[0]=a[0]-(e-1):r[0]=a[0],a[1]<0?r[1]=n+(a[1]-1):a[1]>=n?r[1]=a[1]-(n-1):r[1]=a[1],r}importScripts("//cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.0/seedrandom.min.js"),onmessage=function(a){console.log("Message received from main script"),generateMap(a.data)};